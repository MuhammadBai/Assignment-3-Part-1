## Assignment-3-Part-1

# Task 1:
Lets start with task one which is to create the system user `webgen` with its home directory at `/var/lib/webgen` and its subdirectories `bin/` and `HTML/`

`index.html`

`index.html` file is the static HTML page which is generated by `generate_index` script and stored in `/var/lib/webgen/HTML` directory which has the following information:
#### Why we need this?
This is a dynamically generated HTML file that displays key system information. It is like a summary page that can be  viewed in a browser

* Kernel release of the system.
* Operating System in this case Arch Linux.
* Current date in `DD/MM/YYYY` format.
* Number of installed packages on the system.

*The file is designed to be easily viewed either through a web server or directly in a browser, offering a quick and clear snapshot of the system's current status. It's part of a larger automation process, such as the webgen utility, which regularly updates and presents the system's details. This helps you stay informed about things like the system's kernel version, operating system, installed packages, in a web format.*

generate_index script
This Bash script generates and writes the `index.html` file.

**1) it sets strict error handling in case of errors**

`set -euo pipefail`
* set -e: The -e exits the script if any command fails.
* set -u: It treats unset variables as errors.
* pipefail: Capture errors in pipelines.

**2) Define variables
```
KERNEL_RELEASE=$(uname -r)
OS_NAME=$(grep '^PRETTY_NAME' /etc/os-release | cut -d '=' -f2 | tr -d '"')
DATE=$(date +"%d/%m/%Y")
PACKAGE_COUNT=$(pacman -Q | wc -l)
OUTPUT_DIR="/var/lib/webgen/HTML"
OUTPUT_FILE="$OUTPUT_DIR/index.html"
```
### 1. `KERNEL_RELEASE=$(uname -r)`
* `uname -r`: This command outputs the version of the Linux kernel running on your system.
* `KERNEL_RELEASE=$(...)`: This syntax assigns the result of the uname `-r` command to a variable named `KERNEL_RELEASE`. So, this variable will store your system's kernel version inside of it.

### 2. `OS_NAME=$(grep '^PRETTY_NAME' /etc/os-release | cut -d '=' -f2 | tr -d '"')`
* `grep '^PRETTY_NAME' /etc/os-release`: This command searches for a line in the `/etc/os-release` file that begins with `PRETTY_NAME.` This file contains information about your operating system, and `PRETTY_NAME` typically holds a user-friendly name of the OS.
* `cut -d '=' -f2`: This command splits the line at the `=` sign and extracts the second part (after the =), which will be the OS name.
* `tr -d '"'`: This command removes any quotation marks (`"`) from the result. Some OS names in the file might be enclosed in quotes, so this ensures the name is clean.
* `OS_NAME=$(...)`: The result is assigned to the variable `OS_NAME`, which will store the name of the operating system, such as "Arch Linux".

### 3. `DATE=$(date +"%d/%m/%Y")`
* `date +"%d/%m/%Y"`: The date command formats the current date. The `+"%d/%m/%Y"` specifies the format: day (`%d`), month (`%m`), and year (`%Y`) in the `dd/mm/yyyy` format.
`DATE=$(...)`: The formatted date is assigned to the variable **DATE**. So, DATE will store the current date in `dd/mm/yyyy format`.

### 4. `PACKAGE_COUNT=$(pacman -Q | wc -l)`
* `pacman -Q`: This command lists all installed packages on an Arch Linux system (or systems using pacman as the package manager).
* `| wc -l`: This pipes (`|`) the output of the `pacman -Q` command into the `wc` (word count) command with the `-l` flag. The `-l` flag counts the number of lines.
* `PACKAGE_COUNT=$(...)`: The number of installed packages is stored in the variable `PACKAGE_COUNT`. So, `PACKAGE_COUNT` will store the total number of installed packages on the system.

### 5. `OUTPUT_DIR="/var/lib/webgen/HTML"`
* `OUTPUT_DIR="/var/lib/webgen/HTML"`: This line simply assigns the directory path `/var/lib/webgen/HTML` to the variable `OUTPUT_DIR`. This path will be used to store or output files.

### 6. `OUTPUT_FILE="$OUTPUT_DIR/index.html"`
* `$OUTPUT_DIR/index.html`: This references the `OUTPUT_DIR` variable and appends `index.html` to it, which means the full path will be `/var/lib/webgen/HTML/index.html`. This is where an HTML file will be saved or generated.
* `OUTPUT_FILE="$OUTPUT_DIR/index.html`": The full file path is stored in the variable `OUTPUT_FILE`.

#### To Summarize the above code:
* `KERNEL_RELEASE`: Stores the version of the Linux kernel.
* `OS_NAME`: Stores the name of the operating system.
* `DATE`: Stores the current date.
* `PACKAGE_COUNT`: Stores the number of installed packages.
* `OUTPUT_DIR`: Specifies the directory where HTML files will be saved.
* `OUTPUT_FILE`: Specifies the full path of the HTML file to be created.

### 3. Check and create target directory
```
if [[ ! -d "$OUTPUT_DIR" ]]; then
    echo "Error: Failed to create or access directory $OUTPUT_DIR." >&2
    exit 1
fi
```
Ensures the directory `/var/lib/webgen/HTML` exists. If not, it exits with an error message.
### 1. `if [[ ! -d "$OUTPUT_DIR" ]]`; then
* `[[ ... ]]`: This is a conditional expression in Bash, used to evaluate a test.
* `!`: This is a logical negation operator, meaning "not". It reverses the result of the test that follows.
* `-d "$OUTPUT_DIR"`: This checks if the directory stored in the `OUTPUT_DIR` variable exists. The `-d` option tests if the given path is a directory.
* `"$OUTPUT_DIR"`: This is the variable that stores the directory path (`/var/lib/webgen/HTML` in the previous example).
`if [[ ! -d "$OUTPUT_DIR" ]]`; then: The condition checks if the directory does not exist. If it doesn't exist, the code inside the if block will execute.

### 2. `echo "Error: Failed to create or access directory $OUTPUT_DIR." >&2`
* `echo`: This command prints text to the terminal.
* `"Error`: Failed to create or access directory `$OUTPUT_DIR`.": This is the error message that will be printed. It includes the `OUTPUT_DIR` variable, so it will display the full directory path in the message (e.g., "Error: Failed to create or access directory `/var/lib/webgen/HTML`.").
* `>&2`: This redirects the output of the echo command to standard error (stderr). By default, echo prints to standard output (stdout), but `>&2` ensures the error message goes to `stderr`, which is useful for error logging or handling.

### 3. `exit 1`
* `exit`: This command ends the script.
* `1`: The exit status code. In Unix-like systems, an exit status of 0 means success, and any non-zero value means an error. In this case, 1 indicates an error or abnormal termination of the script.
* `exit 1`: This ends the script with an error status (code 1) if the directory doesn't exist.

#### To Sum it up:
This part of the script checks if the directory specified in `OUTPUT_DIR` exists.
* if the directory doesnt exist, the script prints an error message to stderr and then exists with a status code 1 to indicate failure.
* if the directory does exist, the script continues with the next steps. 

**Explaination**

### 4. Generate the HTML file
The script uses a heredoc to dynamically create the HTML file with the retrieved data:
```
cat <<EOF > "$OUTPUT_FILE"
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Information</title>
</head>
<body>
    <h1>System Information</h1>
    <p><strong>Kernel Release:</strong> $KERNEL_RELEASE</p>
    <p><strong>Operating System:</strong> $OS_NAME</p>
    <p><strong>Date:</strong> $DATE</p>
    <p><strong>Number of Installed Packages:</strong> $PACKAGE_COUNT</p>
</body>
</html>
EOF
```
### 1. `cat <<EOF > "$OUTPUT_FILE"`
* `cat`: This command reads and outputs the contents of a file or standard input. In this case, it's used in a "here document" to create a block of text.
* `<<EOF`: This is a "here document" syntax in Bash. It tells the shell to take the input that follows until it encounters the delimiter `EOF`. The text between `<<EOF` and `EOF` is treated as input for the command (in this case, the cat command).
* `> "$OUTPUT_FILE"`: The `>` operator redirects the output to a file. In this case, the output will be written to the file stored in the variable `OUTPUT_FILE`, which was defined earlier (e.g., `/var/lib/webgen/HTML/index.html`).ThisThis line opens a new HTML file or overwrites the file stored in `OUTPUT_FILE` and prepares to write the following HTML content into it.

#### To Finalize:
1. This script uses a here document to generate an HTML file and populate it with system information.
2. The file is written to the location specified in the `OUTPUT_FILE` variable `/var/lib/webgen/HTML/index.html`.
3. The values for kernel release, operating system, date, and package count are dynamically inserted into the HTML from the previously defined variables (`$KERNEL_RELEASE`, `$OS_NAME`, `$DATE`, `$PACKAGE_COUNT`).
**This script generates a system information page that can be viewed in a web browser.**

5. Check if the file was created( Error Handling)
```
if [ $? -eq 0 ]; then
    echo "Success: File created at $OUTPUT_FILE."
else
    echo "Error: Failed to create the file at $OUTPUT_FILE." >&2
    exit 1
fi
```
### 1. `if [ $? -eq 0 ]; then`
* `$?`: This special variable stores the exit status (or return code) of the last command that was executed.
If the last command was successful, `$?` will be `0`.
If the last command failed, `$?` will be a non-zero value.
* [ $? -eq 0 ]: This checks whether the exit status of the previous command is equal to 0. The `-eq` operator means "equal to".
If `$? is 0` the code inside the if block will run.
If `$? is not 0`  the code inside the else block will run.
if `[ $? -eq 0 ]`; then: This begins the if statement and checks whether the previous command was successful.

### 2. `echo "Success: File created at $OUTPUT_FILE`."
* `echo`: This command prints text to the terminal.
* `"Success: File created at $OUTPUT_FILE`.": This is the success message. The OUTPUT_FILE variable is included in the message, so it will display the full path of the file that was created (e.g., `/var/lib/webgen/HTML/index.html`).
* if $? is 0) the message will be printed.

### 3. `else`
The `else` part of the if statement specifies what to do if the condition `[ $? -eq 0 ]` is not true if the previous command failed.
If the previous command did not execute successfully, the script will execute the commands inside the else block.

### 4. `echo "Error: Failed to create the file at $OUTPUT_FILE." >&2`
* `echo`: This command prints text to the terminal.
* `"Error`: Failed to create the file at `$OUTPUT_FILE.`": This is the error message. It includes the `OUTPUT_FILE` variable, so the error message will display the path where the file creation failed which is `/var/lib/webgen/HTML/index.html).
* `>&2`: This redirects the output to standard error (stderr), instead of the default standard output (stdout). This is useful for logging or distinguishing error messages from regular output.
This message is printed if the previous command failed if $? is not 0.

### 5. `exit 1`
* `exit`: This command ends the script.
* `1`: The exit status code. In Unix-like systems, an exit status of `0` means success, and any non-zero value means an error. By using `exit 1`, the script signals an error condition and terminates.
* `exit 1`: This command will stop the script and return an error status if the file creation failed.w

### 6. `fi`
This closes the if statement. The if block must end with fi (fi is opposite of if).

*The script is designed to be run automatically at regular intervals such as through a cron job as we learned in the class or whenever needed, to refresh the system information shown in the index.html file. This ensures that the displayed details are always up to date, whether you’re viewing them regularly or on-demand*

**Why is this important?**

The `index.html` stays in `/var/lib/webgen/HTML` to keep it organized and seperate from other system files.
The `generate_index` script is stored in `/var/lib/webgen/bin` because binaries which are executable files are commonly kept in a bin directory.
These locations align with Linux's standard filesystem hierarchy.

**After above Next steps!**
Test the `generate_index` script:
Run the script and ensure the `index.html` file is correctly generated with up-to-date information.

**Serve the file via a web server**: To make this file accessible over the network, we will configure a web server linginx to serve /var/lib/webgen/HTML.

**Important** 
It is important that the directory is created and owned by `webgen` system user before running the script if the directory `/var/lib/webgen/HTML` does not exist it will return an error!





